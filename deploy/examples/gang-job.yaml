apiVersion: batch/v1
kind: Job
metadata:
  name: gang-demo
  namespace: default
spec:
  completions: 3
  parallelism: 3
  template:
    metadata:
      labels:
        batch.scheduling.k8s.io/gang: gang-demo
      annotations:
        batch.scheduling.k8s.io/min-available: "3"
    spec:
      restartPolicy: Never
      schedulerName: batch-scheduler
      containers:
        - name: workload
          image: busybox:1.36
          command: ["/bin/sh", "-c", "echo I am running on $(NODE_NAME); sleep 30"]
          env:
            - name: NODE_NAME
              valueFrom:
                fieldRef:
                  fieldPath: spec.nodeName
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
